version: '3.8'

services:
  # 服务 1: 后端 (Python)
  backend:
    build: ./server            # 使用 server 目录下的 Dockerfile 构建
    container_name: german-backend
    ports:
      - "8000:8000"            # 把容器的 8000 端口映射到电脑的 8000
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY} # 读取环境变量
    restart: always

  # 服务 2: 前端 (React/Nginx)
  frontend:
    build: .                   # 使用根目录下的 Dockerfile 构建
    container_name: german-frontend
    ports:
      - "80:80"                # 把容器的 80 端口映射到电脑的 80 (即直接访问 localhost)
    depends_on:
      - backend                # 确保后端先启动
    restart: always